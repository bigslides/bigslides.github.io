<!Doctype: HTML w/ Processing>

<html>

  <head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
      <title>Processing Demo</title>
      <script type="text/javascript" src="js/processing.js"></script>
  </head>
  
  <body>
    <h1>Lance Corporal: The Game</h1>
    <p>You shouldn't understand this game unless you understand the wise spirit of Chesty Puller.</p>
    
    <script type="text/processing">
    
         PImage bg, lancecorporal, lt, start, restart;
    int bgx, bgy, lcplx, lcply, g, Vlcply, i;
    int[] pipeX, pipeY; //Declare two arrays
    int gameState, score;
    import processing.sound.*;
    SoundFile file;
    String audioName = "the_marines_hymn.mp3";
    String path;

    void setup() //Only runs once.
    {
      size(800,620);
      start = loadImage("./img/start.png");
      restart = loadImage("./img/dd214.png");
      bg = loadImage("./img/bg.png");
      lancecorporal = loadImage("./img/lancecorporalmafia.png");
      lt = loadImage("./img/lt.png");
      lcplx = 100;
      lcply = 50;
      g = 1; //Gravity variable == Speed of downward acc.
      pipeX = new int[5]; //Array of length four.
      pipeY = new int[pipeX.length]; //Same length as pipeX.
      for(int i = 0; i < pipeX.length; i++) //Populate the array with values.
      {
        pipeX[i] = width + 200*i;
        pipeY[i] = (int)random(-350, 0);
      }
      gameState = -1;
      path = sketchPath(audioName);
      file = new SoundFile(this,path);
      file.play();
    } 

    void draw() //Main game loop
    {
      if(gameState==-1)
      {
        startScreen();
      }
      else if(gameState==0)
      {
        setBg();
        setPipes();
        lcplcontrol(); // Puts the character on top.
        score();

      }
      else
      {
        restart();
        text("I NEED A MARINE FOR WORKING PARTY", 20,100);
      }
    }

    void restart()
    {
      image(restart, 0, 0);
      if(mousePressed)
      {
        gameState = 1;
        setup();
        file.amp(0.0);
      }
    }

    void startScreen()
    {
      image(start, 0, 0);
      if(mousePressed)
      {
        lcply = height/2;
        gameState=0;
      }
    }

    void score()
    {
      fill(255);
      textSize(32);
      text("Non-Judicial Punishments: " + score, width = 170,48);
    }

    void setPipes()
    {
      for(int i = 0; i < pipeX.length; i++) //Populate the array with values.
      {
        image(lt, pipeX[i], pipeY[i]);
        image(lt, pipeX[i], pipeY[i] + 680);

        //Sets difficulty
        if(score<5){
          pipeX[i]-=1;
        }
        else
        {
          text("Gunny's getting suspicious", 40, 34);
          pipeX[i]-=3;
        }

        pipeX[i]-=2;
        if(pipeX[i] < -200)
        {
          pipeX[i] = width;
        }
        if(lcplx > (pipeX[i]-35) && lcplx < pipeX[i] + 101)
        {
          if(!(lcply > pipeY[i] + 450 && lcply < pipeY[i] + (450 + 230-45)))
          {
            gameState = 1;
          }
          else if (lcplx==pipeX[i] || lcplx == pipeX[i] + 1) 
          {
            score++;
          }
      }
     }
    }

    void lcplcontrol()
    {
      image(lancecorporal, lcplx, lcply);
      lcply = lcply + Vlcply;
      Vlcply = Vlcply + g;
      if(lcply >height || lcply < 0)
      {
        text("First Sergeant wants you to mop up the deck, boot.", 40, 34);
        gameState=1;
      }
    }

    void mousePressed()
    {
      Vlcply = -15;
      //gameState = 1;
    }

    void setBg()
    {
      image(bg, bgx, bgy);
      image(bg, bgx + bg.width, bgy);
      bgx = bgx -4;
      if(bgx < -bg.width)
      {
        bgx = 0; //Recycles the image once it gets to the end.
      }
    }

    </script>
    <canvas id="sketch" style="border: 1px solid black;"></canvas>
    
  </body>
  
</html>
